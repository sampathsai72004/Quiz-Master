{% extends "layout.html" %}

{% block title %}Login - Quiz Master{% endblock %}

{% block content %}
    <div class="login-container">
        <h1>Quiz Master</h1>
        <h3>Login</h3>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}


        <form id="loginForm" method="POST" action="{{ url_for('routes.login', role=role) }}">
            <!-- Username Field -->
            <label for="username">Username (E-mail):</label>
            <input type="email" id="username" name="username" placeholder="Enter your email" required class="input-field" value="{{ request.form.username if request.form.username }}">

            <label for="password">Password:</label>
            <div class="input-wrapper">
                <input type="password" id="password" name="password" placeholder="Enter your password" required class="input-field">
                <span class="toggle-password" id="togglePassword">
                    <i class="fas fa-eye"></i>
                </span>
            </div>

    
            <button type="submit" class="btn">Login</button>
        </form>

    
        <div class="links">
            <a href="#">Forgot Password?</a>
            {% if role|default('') == 'user' %}
                <a href="{{ url_for('routes.register') }}">Create new account</a>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const togglePassword = document.getElementById("togglePassword");
            const passwordField = document.getElementById("password");

            togglePassword.addEventListener("click", () => {
                if (passwordField.type === "password") {
                    passwordField.type = "text";
                    togglePassword.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    passwordField.type = "password";
                    togglePassword.innerHTML = '<i class="fas fa-eye"></i>';
                }
            });

        
            document.getElementById("loginForm").addEventListener("submit", function (e) {
                const username = document.getElementById("username").value.trim();
                const password = document.getElementById("password").value.trim();

                if (!username || !password) {
                    e.preventDefault();
                    alert("Please fill in all fields.");
                    return;
                }

               
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(username)) {
                    e.preventDefault();
                    alert("Please enter a valid email address.");
                    return;
                }
            });
        });
    </script>
{% endblock %}